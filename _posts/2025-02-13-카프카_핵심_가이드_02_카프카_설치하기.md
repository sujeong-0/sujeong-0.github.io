---
title: 카프카 핵심 가이드 - 02 카프카 설치하기
description: >-
  카프카에 대해 정확하게 알기 위해 <kbd>카프카 핵심 가이드(그웬 샤피라, 토드 팔리노, 라지니 시바람, 크리트 페티 지음 / 이동진 옮김)</kbd>을 읽으며 공부한 내용을 정리
author: ggong
date: 2025-02-13 08:45:00 +0800
categories: [ Book, Kafka ]
tags: [ book, kafka, study, unclear ]
pin: true
media_subpath: '/assets/img/kafka'
---

## 환경 설정

### 운영체제 선택하기

아파치 카프카는 다양안 운영체제에서 실행가능한 자바 애플리케이션으로, 다양한 운영체제에서 실행이 가능하지만 대체로 리눅스가 권장된다.

### 자바 설치하기

카프카와 주키퍼는 모든 OpenJDK 기반 자바 구현체 위에서 원활히 작동된다.
카프카 최신 버전은 java 8과 11을 모두 지원한다.

### 주피커 설치하기

카프카는 카프카 클러스터의 메타데이터와 컨슈머 클라이언트에 대한 정보를 저장하기 위해 주피커를 사용한다.

![Build source](2-1.png){: .light .normal w='500'}

**주키퍼**
: 설정 정보 관리, 이름 부여, 분산 동기화, 그룹 서비스를 지공하는 중앙화된 서비스

## 카프카 브로커 설치하기

> 이 부분은 실제 설치 관련 글을 따로 작성 하려고 제외함
{: .prompt-warning }

## 브로커 설정하기

카프카에는 거의 모든 구성을 제어하고 튜닝할 수 있는 옵션 설정이 있는데, 대부분 특별한 사례가 아니라면 바꿀 일이 없다.

### 핵심 브로커 매개변수

브로커의 기본적인 설정을 담당하며, 대부분은 다른 브로커와 함께 클러스터 모드로 작동하기 위해서는 값을 변경해야한다.

**`broker.id`**
: 모든 카프카 브로커는 정숫값의 식별자를 갖는다.
: 클러스터 내의 모든 브로커들은 `broker.id`를 다르게 가져야한다.
: 임의로 설정이 가능하다.<question>필요하다면, 브로커 간에 이동도 가능하다.</question>

> **필요하다면, 브로커 간에 이동도 가능하다?**
: 브로커를 교체하거나 클러스터를 재구성할 때, 기존 브로커의 `broker.id`를 새로운 브로커에게 할당 가능하다.
{: .prompt-question .ms-4 }

**`listener`**
: 리스너는 `{프로토콜}://{호스트이름}:{포트}`의 형태를 가진다.
: 여러 개의 리스너를 쉼표`,`로 구분해 지정할 수 있다.

> 구버전은 단순한 port 설정을 사용했으나, 지원이 중단되었다.
{: .prompt-info .ms-4 }

**`zookeeper.connect`**
: 주키퍼의 위치를 가리킨다.
: `{호스트이름}:{포트}/{경로}`의 형태를 가진다.
: 세미콜론`;`으로 구분해 지정할 수 있다.


**`log.dir` / `log.dirs`**
: 로그 위치를 가리킨다.
: 카프카는 모든 메시지를 로그 세그먼트 단위로 묶어서 `log.dir` 설정에 지정된 디스크 디렉토리에 저장한다.
: 다수의 디렉토리를 지정할 경우, `log.dirs`를 사용해 지정하면된다.
: `log.dirs`가 지정되어 있지 않은 경우 `log.dir`를 사용한다.
: `log.dirs`에 1개 이상의 경로가 지정된 경우, <question>브로커는 가장 적은 수의 파티션이 저장된 디렉토리에 새 파티션을 저장할 것이다.</question>

> **브로커는 가장 적은 수의 파티션이 저장된 디렉토리에 새 파티션을 저장할 것이다?**
> 만약 현재, 2개의 디렉토리에 파티션이 나눠져 저장되어있다고 가정해보자.
> A 디렉토리에 5개, B 디렉토리에 3개가 저장되어 있다면, 새로운 파티션을 저장할 때 더 적은 파티션을 가지고 있는 B 디렉토리에 저장될 수 있도록 설정한다.
> 이 때, 중요한 점은 **디렉토리의 용량이 아닌 파티션의 개수로 비교한다는 것**이다.
{: .prompt-question .ms-4}

**`nums.recoery.threads.per.data.dir`**~~~~
: 카프카는 스레드 풀을 사용해서 로그 세그먼트를 관리한다.
: 하나의 로그 디렉토리에 대해 하나의 스레드만이 사용된다. 이 스레드들은 브로커가 시작될 때와 종료될 때만 사용되기 때문에 작업을 병렬화하기 위해서는 많은 스레드를 할당하는 것이 좋다.

> **스레드 풀이 하는 일**
> - 브로커가 **정상적으로 시작**되었을 때, 각 파티션의 로그 세그먼트 파일을 연다.
> - 브로커가 **장애 발생 후 재시작**되었을 때, 각 파티션의 로그 세그먼트를 검사하고 잘못된 부분은 삭제한다.
> - 브로커가 **종료**할 때, 로그 세그먼트를 정상적으로 닫는다.
{: .prompt-info .ms-4 }

**`auto.create.topics.enable`**
: 브로커가 토픽을 자동으로 생성하는 몇몇 경우가 있는데, 이는 바람직하지 않은 경우가 많다.<br><question>토픽을 생성하지 않고, 토픽의 존재 여부를 확인할 방법이 없다.</question>
: 이 때, 자동으로 생성할 수 있게 할지에 대한 값이다.

> **자동으로 토픽이 생성되는 경우**
> - 프로듀서가 토픽에 메시지를 쓰기 시작할 때 = **없는 토픽에** 쓰려고 함
> - 컨슈머가 토픽으로부터 메시지를 읽기 시작할 때 = **없는 토픽을** 읽으려고 함
> - 클라이언트가 토픽에 대한 메타데이터를 요청할 때 = **없는 토픽의** 메타데이터를 요청함
{: .prompt-info .ms-4 }

> **토픽을 생성하지 않고, 토픽의 존재 여부를 확인할 방법이 없다?**
> 토픽의 존재 여부를 확인하는 방법
> - `kafka-topics.sh --describe --topic my-topic` 같은 명령어
> - `Kafka AdminClient API (describeTopics()호출)`가 있다.
>
> 설정에 따른 결과
> `auto.create.topics.enable=true`시, 위의 방법으로 확인한다면 **kafka가 토픽을 생성**한다.
> `auto.create.topics.enable=false`시, 위의 방법으로 정확하게 확인할 수 있다.
{: .prompt-question .ms-4 }

**`auto.leader.rebalance.enable`**
: 토픽의 리더가 하나의 브로커에 집중되지 않도록 하는 설정이다.
: 설정을 켜면, 파티션의 분포 상태를 주기적으로 확인하는 백그라운드 스레드가 시작된다.


**`delete.topic.enable`**
: 클러스터의 토픽을 임의로 삭제하지 못하도록 하는 설정이다.

### 토픽별 기본값



## 하드웨어 선택하기

## 클라우드에서 카프카 사용하기

## 카프카 클러스터 설정하기

## 프로덕션 환경에서의 고려사항

## 요약
